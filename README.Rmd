---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = '100%'
)
```

# rsinaica

[![Travis-CI Build Status](https://travis-ci.org/diegovalle/rsinaica.svg?branch=master)](https://travis-ci.org/diegovalle/rsinaica) 
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/p281myk561l2kxgt?svg=true)](https://ci.appveyor.com/project/diegovalle/rsinaica/branch/master) 
[![Coverage Status](https://img.shields.io/codecov/c/github/diegovalle/rsinaica/master.svg)](https://codecov.io/github/diegovalle/rsinaica?branch=master)
[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-red.svg)](https://www.tidyverse.org/lifecycle/#experitmental) 
[![CRAN\_Status\_Badge](http://www.r-pkg.org/badges/version-ago/rsinaica?color=red)]()

Ready-made functions for downloading air quality data from the Mexican National 
Air Quality Information System (SINAICA).

## Installation

rsinaica is not currently available from CRAN, but you can install the development version from github with:

```r
if (!require(devtools)) {
    install.packages("devtools")
}
devtools::install_github('diegovalle/rsinaica')
```


<!--ou can install the released version of rsinaica from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("rsinaica")
```-->

## Example

Suppose you wanted to download pollution data from the 'Centro' station in
Guadalajara. First we load the package and look up the numeric code
for the station in the `stations_sinaica` data.frame:

```{r example, warning=FALSE}
library("rsinaica")
library("ggplot2")

knitr::kable(stations_sinaica[which(stations_sinaica$station_name == "Centro"), 1:6])
```

The station Centro located in Guadalajara has a numeric code of 102 (station_id). The ```stations_sinaica``` data.frame also includes the locations of all the measuring stations in Mexico (including some that have never reported any data!).

```{r warning=FALSE}
mx <- map_data("world", "Mexico")
stations_sinaica$color <- "Others"
stations_sinaica$color[stations_sinaica$station_id == 102] <- "Centro"
ggplot(stations_sinaica[order(stations_sinaica$color, decreasing = TRUE),], aes(lon, lat)) + 
  geom_polygon(data = mx, aes(x= long, y = lat, group = group)) +
  geom_point(alpha = .9, size = 3, aes(fill = color), shape = 21) + 
  scale_fill_discrete("station") +
  ggtitle("Air quality measuring stations in Mexico") +
  coord_map() + 
  theme_void()
```

Then we query the dates during which the station has been in operation:

```{r}
get_station_dates(102, "C")
```

It's currently reporting data. We can also query which type of parameters (pollution, wind, solar radiation, etc) the station has sensors for.

```{r}
get_station_parameters(102)
```

Finally, we can download and plot particulate matter data for the month of January

```{r}
# Download all PM10 data for January 2018
df <-  sinaica_station(102, "PM10", "C", "2018-01-01", "4")

ggplot(df, aes(hour, value, group = date)) +
  geom_line(alpha=.9) +
  ggtitle(expression(paste(PM[10],
                           " pollution during January 2018 in Centro, Guadalajara, by hour"))) +
  xlab("hour") +
  ylab(expression(paste(mu,"g/", m^3))) +
  theme_bw()
```
