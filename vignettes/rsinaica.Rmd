---
title: "Introduction to the rsinaica Package"
author: "Diego Valle-Jones"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.dim = c(11,6)
)
```

The *Instituto Nacional de Ecología y Cambio Climático* (INECC) created a
website to gather all the information generated by all the air quality
monitoring stations in the different Mexican states.

Load the packages necessary for running the analysis

```{r message=FALSE}
library("rsinaica")
library("dplyr")
library("ggplot2")
library("lubridate")
```

Let's suppose you want to look up the ozone pollution values for the station of
Apodaca in Monterrey.


```{r}
knitr::kable(stations_sinaica[which(stations_sinaica$station_name == "Apodaca"),])
```

The station has a station_id of 146 which we can use to look up data

```{r download}
# Download all PM2.5 data for 2017, by month
df <-  sinaica_station(146, "PM10", "C", "2018-03-04", "4")
```

The data we just downloaded looks like:

```{r table}
knitr::kable(head(df))
```

The hour column comes in a format with no daylight savings time
(the `sinaica_station` data.frame has a 
column named timezone which may prove helpful when you want to know the
timezone of each station)

```{r plot,fig.height=5,fig.width=7}
df$datetime <-  with_tz(as.POSIXct(paste0(df$date, " ", df$hour, ":00"), 
                                  tz = "Etc/GMT+6"),
                       tz = "America/Monterrey")

ggplot(df, aes(datetime, value)) +
  geom_line() +
  theme_bw()
```

From the chart it's obvious there was some sort of equipment failure right around the time
the daylight savings time changed

```{r}
# Time changed at 2:00 AM 2018-04-01
knitr::kable(head(df[df$date %in% c("2018-04-01"),]))
```
